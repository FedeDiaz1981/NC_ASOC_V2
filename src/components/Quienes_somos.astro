---
/**
 * Quienes_somos.astro — i18n + fallbacks
 * - Lee textos desde dictionaries[lang].about
 * - Mantiene estilos y AOS
 * - Permite overrides por props: headline, introHtml, ctaText, ctaHref, members
 */

import { dictionaries, type Locale } from "../i18n";
import { lnk } from "../i18n/routing";

import img_1 from "../img/P_01.png";
import img_2 from "../img/P_02.png";
import img_3 from "../img/P_03.png";

interface Member {
  name: string;
  role: string;
  photo: string;
  tagline?: string;
}

interface Props {
  lang?: Locale;
  headline?: string;
  introHtml?: string;
  ctaText?: string;
  ctaHref?: string;
  members?: Member[];
}

const { lang = "es" } = Astro.props;
const dict = dictionaries[lang].about;

// Textos: props > diccionario
const bandTitle = dict.bandTitle;
const headline  = Astro.props.headline  ?? dict.headline;
const introHtml = Astro.props.introHtml ?? dict.introHtml;
const ctaText   = Astro.props.ctaText   ?? dict.ctaText;
const rawHref   = Astro.props.ctaHref   ?? dict.ctaHref;
const ctaHref   = rawHref ? (typeof lnk === "function" ? lnk(lang, rawHref) : rawHref) : undefined;

// Miembros: props > diccionario > fallback imágenes locales
const dictMembers  = dict.members ?? [];
const propsMembers = Astro.props.members ?? dictMembers;

const fallbackPhotos = [img_1.src, img_2.src, img_3.src];

const members: Member[] = propsMembers.length
  ? propsMembers.map((m, i) => ({
      name: m.name,
      role: m.role,
      photo: m.photo || fallbackPhotos[i % fallbackPhotos.length],
      tagline: m.tagline,
    }))
  : [
      { name: "María Pérez", role: "Abogada", photo: img_1.src },
      { name: "Laura Gómez", role: "Abogada", photo: img_2.src},
      { name: "Ana Rodríguez", role: "Abogada", photo: img_3.src },
    ];
---

<section class="relative isolate">
  <!-- FRANJA DE TÍTULO -->
  <div class="py-10">
    <h2
      class="text-center text-2xl md:text-3xl font-bold tracking-wide text-hueso
             relative after:content-[''] after:block after:w-24 after:h-[2px]
             after:bg-beige after:mx-auto after:mt-3"
    >
      {bandTitle}
    </h2>
  </div>

  <!-- BLOQUE PRINCIPAL -->
  <div class="relative z-10 max-w-7xl mx-auto px-4">
    <div class="grid lg:grid-cols-[0.9fr_1.1fr] rounded-xl overflow-hidden shadow-xl">
      <!-- Panel izquierdo -->
      <div class="bg-azulProfundo p-10 flex items-center justify-center">
        <div class="text-center md:text-left">
          <h3 class="text-hueso font-semibold text-2xl md:text-3xl leading-tight">
            {headline}
          </h3>
          <div class="mt-3 h-[2px] w-full bg-beige mx-auto md:mx-0"></div>
        </div>
      </div>

      <!-- Panel derecho -->
      <div class="bg-hueso p-8 md:px-10 md:py-14 text-azulProfundo">
        <div class="max-w-prose space-y-4 text-sm md:text-base md:px-8" set:html={introHtml}></div>

        {ctaText && ctaHref && (
          <a
            href={ctaHref}
            class="mt-6 inline-block rounded-full bg-beige text-azulProfundo px-5 py-2 font-semibold
                   hover:bg-hueso hover:text-azulAereo transition-colors"
          >
            {ctaText}
          </a>
        )}
      </div>
    </div>

    <!-- EQUIPO -->
    <div class="mt-10">
      <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {members.map((p, i) => (
          <figure
            class="flex flex-col items-center text-center"
            data-aos="fade-up"
            data-aos-delay={String(i * 120)}
          >
            <img
              src={p.photo}
              alt={p.name}
              class="block max-h-[420px] md:max-h-[390px] w-[90%] md:w-auto object-contain
                     drop-shadow-[0_8px_30px_rgba(0,0,0,.35)]
                     pointer-events-none select-none"
              loading="lazy"
            />
            <figcaption class="flex flex-col items-center w-full mt-0">
              <span
                class="inline-block rounded px-3 py-1 text-[11px] uppercase tracking-wide
                       text-hueso bg-azulProfundo/90 backdrop-blur-sm
                       ring-1 ring-beige/60
                       shadow-[0_0_14px_rgba(190,167,123,0.35)]
                       w-full max-w-xs text-center"
              >
                {p.role}
              </span>
              <span
                class="inline-block rounded px-3 py-2 text-xs font-semibold
                       text-hueso bg-azulProfundo/90 backdrop-blur-sm
                       ring-1 ring-beige/60
                       shadow-[0_0_18px_rgba(190,167,123,0.35)]
                       w-full max-w-xs text-center"
              >
                {p.name}
              </span>
            </figcaption>
          </figure>
        ))}
      </div>
    </div>
  </div>
</section>
